# AIエージェント操作マニュアル

> **対象**: AIアシスタント（Cursor AI、ChatGPT、Claude等）
> **目的**: このプロジェクトでAIエージェントが遵守すべき操作仕様、制約、受入条件を定義する

---

## 1. プロジェクト概要

このプロジェクトは、**VibeCoding**という開発プロセスを実践するためのPythonテンプレートです。
AIエージェントは、人間の開発者と協調して、高品質なソフトウェアを効率的に開発することが期待されています。

### 基本原則
- **忠実性**: 実装計画書を絶対的な仕様として遵守する
- **安全性**: セキュリティリスクを最小化する
- **品質**: プロジェクトの技術的制約を厳守する
- **透明性**: 作業内容を明確に記録・報告する

---

## 2. 禁止事項・境界条件

### 2.1. アーキテクチャ境界
- **依存関係の制約**: 以下の依存方向のみ許可
  ```
  utils ← shared ← core
  utils ← domain (稀に)
  ```
- **禁止**: `core` → `utils`、`domain` → `core`、循環依存
- **外部HTTP通信**: `shared/http_client.py`経由でのみ許可（直接的な`requests`使用禁止）

### 2.2. セキュリティ境界
- **機密情報**: `.env*`、`/data/private/`、`*.key`、`*.pem`ファイルには一切触れない
- **コミット禁止**: 秘密情報、APIキー、パスワード、トークンを含むファイル
- **ログ出力**: PII（個人識別情報）が含まれる可能性のある値は必ずマスクする

### 2.3. コード品質境界
- **型ヒント**: すべての関数に引数・戻り値の型ヒントを必須とする
- **例外処理**: 素の`Exception`禁止、`shared.errors.*`のカスタム例外を使用
- **インポート**: 絶対インポートを使用、相対インポート禁止
- **ハードコーディング**: 設定値は`config.settings`経由でのみ取得

---

## 3. 必須作業手順

### 3.1. 実装前チェック
1. **実装計画書の確認**: `docs/development/implementation_plan_*.md`を精読
2. **既存コードの調査**: 影響範囲の特定と既存パターンの理解
3. **依存関係の検証**: アーキテクチャ境界の遵守確認

### 3.2. 実装中の必須作業
1. **コード生成**: 型ヒント、Docstring、エラーハンドリングを含む完全なコード
2. **テスト作成**: 新規関数には最低3ケース（正常系2、異常系1）のテスト
3. **品質チェック**: `ruff check .`、`mypy .`、`pytest`の実行確認

### 3.3. 実装後の必須作業
1. **動作確認**: 実装した機能の動作テスト
2. **ログ更新**: `docs/development/dev_log.md`への進捗記録
3. **完了報告**: 実装内容と次のステップの明確な報告

---

## 4. 受入基準

### 4.1. コード品質基準
- **静的解析**: `ruff check .`でエラー0件
- **型チェック**: `mypy .`でエラー0件  
- **テスト**: `pytest`で全テストパス、カバレッジ80%以上
- **フォーマット**: `ruff format`準拠

### 4.2. セキュリティ基準
- **秘密情報検出**: `detect-secrets`でアラート0件
- **依存関係**: 既知の脆弱性を含むパッケージの使用禁止
- **入力検証**: 外部入力は必ずバリデーション実施

### 4.3. ドキュメント基準
- **Docstring**: すべての公開関数・クラスにGoogleスタイルのDocstring
- **型ヒント**: すべての関数に完全な型アノテーション
- **コメント**: 複雑なロジックには日本語での説明コメント

---

## 5. エラー対応・リトライ方針

### 5.1. 品質チェック失敗時
1. **即座に修正**: lintエラー、型エラーは必ず修正してから次に進む
2. **3回ルール**: 同じエラーが3回発生した場合は人間に質問する
3. **妥協禁止**: 「とりあえず動く」レベルでの完了報告は行わない

### 5.2. 不明点・曖昧点への対応
1. **質問義務**: 実装計画書に曖昧な記述がある場合は必ず質問
2. **推測禁止**: 不明な仕様を勝手に推測して実装しない
3. **代替案提示**: 複数の実装方法がある場合は選択肢を提示

---

## 6. ログ・記録要件

### 6.1. 作業ログ
- **開始時**: 着手するタスクと理解した要件の確認
- **実装中**: 重要な設計判断や技術的課題の記録
- **完了時**: 実装内容、テスト結果、次のステップの明記

### 6.2. 問題・知見の記録
- **技術的問題**: `docs/development/llm_knowhow.md`への記録
- **プロセス改善**: VibeCodingプロセスの改善提案
- **セキュリティ**: セキュリティに関する気づきや対策の記録

---

## 7. 緊急時・例外対応

### 7.1. セキュリティインシデント
- **即座に停止**: 秘密情報の漏洩可能性がある場合は作業を即座に停止
- **報告**: 人間の開発者に詳細を報告
- **証跡保持**: 問題の原因と対応策を記録

### 7.2. 品質基準未達成
- **妥協しない**: 品質基準を満たさない成果物の提出禁止
- **支援要請**: 技術的制約で解決できない場合は人間に支援要請
- **学習**: 同様の問題の再発防止策を検討・記録

---

## 8. 成功基準・KPI

### 8.1. 技術的成功指標
- **品質**: 静的解析・テスト・型チェックの全パス
- **セキュリティ**: セキュリティスキャンでの問題0件
- **性能**: 実装した機能の応答時間が要件内

### 8.2. プロセス成功指標
- **効率**: 計画書通りの順序での実装完了
- **透明性**: 作業内容の明確な記録と報告
- **継続性**: 次の開発者が理解・継続可能な状態での引き継ぎ

---

このマニュアルは、AIエージェントがVibeCodingプロセスを成功させるための包括的なガイドラインです。
不明点がある場合は、必ず人間の開発者に確認を求めてください。
